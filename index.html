<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BTCäº¤æ˜“ä¿¡å·åˆ†æ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px 0 rgba(31, 38, 135, 0.4);
    }
    
    .pulse-animation {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .loading-spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .status-indicator {
      position: relative;
      display: inline-block;
    }
    
    .status-indicator::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border-radius: 50%;
      background: linear-gradient(45deg, #10b981, #34d399);
      z-index: -1;
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
      to { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
    }
  </style>
</head>
<body>

  <div id="root" class="max-w-7xl mx-auto p-6"></div>

  <script>
    async function loadData() {
      // ä½¿ç”¨CORSä»£ç†æ¥è§£å†³è·¨åŸŸé—®é¢˜
      const corsProxy = 'https://api.allorigins.win/get?url=';
      const apiUrl = 'https://financialmodelingprep.com/api/v3/historical-price-full/BTCUSD?timeseries=900&apikey=cKlA3lVOMxMjg4hJsC0cn1YAIUu1Hk8P';
      const proxyUrl = corsProxy + encodeURIComponent(apiUrl);
      
      console.log("æ­£åœ¨é€šè¿‡CORSä»£ç†åŠ è½½æ•°æ®:", proxyUrl);
      
      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) {
          console.error(`ä»£ç†è¯·æ±‚å¤±è´¥: ${response.status} - ${response.statusText}`);
          throw new Error(`ä»£ç†è¯·æ±‚å¤±è´¥: ${response.status}`);
        }
        
        const proxyData = await response.json();
        const data = JSON.parse(proxyData.contents);
        console.log("åŸå§‹APIå“åº”æ•°æ®:", data);

        const historical = data.historical || [];
        console.log("å†å²æ•°æ®æ•°ç»„é•¿åº¦ï¼ˆè¿‡æ»¤å‰ï¼‰:", historical.length);

        const processedData = historical
          .map(item => ({
            date: new Date(item.date),
            price: parseFloat(item.close)
          }))
          .filter(item => item.price != null && !isNaN(item.price))
          .reverse(); // ç¡®ä¿æŒ‰æ—¶é—´æ­£åºæ’åˆ—

        console.log("å¤„ç†åçš„å†å²æ•°æ®é•¿åº¦:", processedData.length);
        if (processedData.length === 0) {
            console.warn("å¤„ç†åçš„å†å²æ•°æ®ä¸ºç©ºï¼Œæœªæ‰¾åˆ°æœ‰æ•ˆçš„ä»·æ ¼æ•°æ®ã€‚");
        }
        return processedData;
      } catch (err) {
        console.error("æ•°æ®åŠ è½½é”™è¯¯:", err);
        console.log("å°è¯•å¤‡ç”¨æ•°æ®æº...");
        return await loadBackupData();
      }
    }

    async function loadBackupData() {
      // å¤‡ç”¨æ•°æ®æºï¼šä½¿ç”¨CoinGecko APIï¼ˆå…è´¹ä¸”æ”¯æŒCORSï¼‰
      console.log("ä½¿ç”¨å¤‡ç”¨æ•°æ®æºï¼šCoinGecko API");
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=90&interval=daily');
        if (!response.ok) {
          throw new Error(`å¤‡ç”¨APIè¯·æ±‚å¤±è´¥: ${response.status}`);
        }
        
        const data = await response.json();
        console.log("å¤‡ç”¨APIå“åº”æ•°æ®:", data);
        
        const processedData = data.prices.map(([timestamp, price]) => ({
          date: new Date(timestamp),
          price: parseFloat(price)
        })).filter(item => item.price != null && !isNaN(item.price));
        
        console.log("å¤‡ç”¨æ•°æ®å¤„ç†å®Œæˆï¼Œé•¿åº¦:", processedData.length);
        return processedData;
      } catch (err) {
        console.error("å¤‡ç”¨æ•°æ®æºä¹Ÿå¤±è´¥:", err);
        // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®ç”¨äºæ¼”ç¤º
        return generateMockData();
      }
    }

    function generateMockData() {
      console.log("ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ç”¨äºæ¼”ç¤º");
      const mockData = [];
      const basePrice = 65000;
      const today = new Date();
      
      for (let i = 89; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        
        // ç”Ÿæˆæ¨¡æ‹Ÿä»·æ ¼æ•°æ®ï¼ŒåŒ…å«ä¸€äº›è¶‹åŠ¿å’Œæ³¢åŠ¨
        const trend = Math.sin(i * 0.1) * 5000;
        const noise = (Math.random() - 0.5) * 2000;
        const price = basePrice + trend + noise;
        
        mockData.push({
          date: date,
          price: Math.max(price, 30000) // ç¡®ä¿ä»·æ ¼ä¸ä¼šå¤ªä½
        });
      }
      
      return mockData;
    }

    function calculateIndicators(data) {
      console.log("å¼€å§‹è®¡ç®—æŒ‡æ ‡ï¼Œæ•°æ®é•¿åº¦:", data.length);
      
      // é¦–å…ˆè®¡ç®—æ‰€æœ‰çš„20æ—¥å‡çº¿
      const dataWithMA = data.map((row, index, arr) => {
        let BTC20MA = null;
        if (index >= 19) { // ç¬¬20ä¸ªæ•°æ®ç‚¹å¼€å§‹è®¡ç®—ï¼ˆç´¢å¼•19ï¼‰
          const prices = arr.slice(index - 19, index + 1).map(r => r.price);
          if (prices.length === 20 && prices.every(p => typeof p === 'number' && !isNaN(p))) {
            BTC20MA = prices.reduce((sum, p) => sum + p, 0) / 20;
          }
        }
        return { ...row, BTC20MA };
      });

      // ç„¶åè®¡ç®—è¶‹åŠ¿ï¼ˆéœ€è¦åœ¨æ‰€æœ‰MAè®¡ç®—å®Œæˆåï¼‰
      const dataWithIndicators = dataWithMA.map((row, index, arr) => {
        let BTC20MAtrend = 'æœªçŸ¥';
        
        if (row.BTC20MA != null && index > 0) {
          const prevBTC20MA = arr[index - 1].BTC20MA;
          if (prevBTC20MA != null) {
            // æ ¹æ®Excelå…¬å¼ï¼šIF(D2>D3,"ä¸Šå‡","ä¸‹é™")
            BTC20MAtrend = row.BTC20MA > prevBTC20MA ? 'ä¸Šå‡' : 'ä¸‹é™';
          }
        }

        return { ...row, BTC20MAtrend };
      });
      
      return dataWithIndicators;
    }

    function generateSignals(data) {
        console.log("å¼€å§‹ç”Ÿæˆäº¤æ˜“ä¿¡å·ï¼Œæ•°æ®é•¿åº¦:", data.length);

        // ä½¿ç”¨ .reduce æ¥æ­£ç¡®å¤„ç†ä¾èµ–å‰ä¸€å¤©è®¡ç®—ç»“æœçš„é€»è¾‘
        const dataWithSignals = data.reduce((accumulator, currentRow, index) => {
            let signal = '';
            
            // ä»accumulatorä¸­è·å–å‰ä¸€å¤©çš„æ­£ç¡®ä»“ä½çŠ¶æ€ï¼Œaccumulatoræ˜¯æˆ‘ä»¬æ­£åœ¨å»ºç«‹çš„ç»“æœæ•°ç»„
            const prevPosition = index > 0 ? accumulator[index - 1].POSITION : 'ç©ºä»“';
            
            // é»˜è®¤æƒ…å†µä¸‹ï¼Œä»Šå¤©çš„ä»“ä½ç»§æ‰¿è‡ªæ˜¨å¤©
            let currentPosition = prevPosition;

            // ä»ç¬¬20ä¸ªæ•°æ®ç‚¹å¼€å§‹ï¼ˆç´¢å¼•ä¸º19ï¼‰ï¼Œæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„æ•°æ®æ¥è®¡ç®—ä¿¡å·
            if (index >= 19 && currentRow.BTC20MA != null && currentRow.BTC20MAtrend !== 'æœªçŸ¥') {
                const currentPrice = parseFloat(currentRow.price);
                const currentMA = parseFloat(currentRow.BTC20MA);
                const currentTrend = currentRow.BTC20MAtrend;

                if (currentPrice && currentMA && currentTrend) {
                    const buyThreshold = currentMA * 1.01;  // å‡çº¿ä¸Šæ–¹1%
                    const sellThreshold = currentMA * 0.99; // å‡çº¿ä¸‹æ–¹1%
                    
                    // ä¹°å…¥æ¡ä»¶æ£€æŸ¥ï¼ˆä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼‰
                    const condition1_buy = prevPosition === 'ç©ºä»“';
                    const condition2_buy = currentTrend === 'ä¸Šå‡';
                    const condition3_buy = currentPrice > buyThreshold;
                    
                    if (condition1_buy && condition2_buy && condition3_buy) {
                        signal = 'ä¹°å…¥';
                        currentPosition = 'æŒæœ‰'; // ä¹°å…¥åï¼Œä»Šæ—¥ä»“ä½è½¬ä¸º'æŒæœ‰'
                    }
                    
                    // å–å‡ºæ¡ä»¶æ£€æŸ¥ï¼ˆä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼‰
                    const condition1_sell = prevPosition === 'æŒæœ‰';
                    const condition2_sell = currentTrend === 'ä¸‹é™';
                    const condition3_sell = currentPrice < sellThreshold;
                    
                    if (condition1_sell && condition2_sell && condition3_sell) {
                        signal = 'å–å‡º';
                        currentPosition = 'ç©ºä»“'; // å–å‡ºåï¼Œä»Šæ—¥ä»“ä½è½¬ä¸º'ç©ºä»“'
                    }
                }
            }

            // å°†è®¡ç®—å¥½çš„å½“å‰è¡Œæ•°æ®ï¼ˆåŒ…æ‹¬ä¿¡å·å’Œæ­£ç¡®çš„ä»“ä½ï¼‰æ·»åŠ åˆ°ç»“æœæ•°ç»„ä¸­
            accumulator.push({ 
                ...currentRow, 
                Signal: signal, 
                POSITION: currentPosition 
            });

            // è¿”å›æ›´æ–°åçš„ç»“æœæ•°ç»„ï¼Œä¾›ä¸‹ä¸€æ¬¡è¿­ä»£ä½¿ç”¨
            return accumulator;
        }, []); // åˆå§‹å€¼æ˜¯ä¸€ä¸ªç©ºæ•°ç»„

        // ç»Ÿè®¡ä¿¡å·
        const allSignals = dataWithSignals.filter(r => r.Signal && r.Signal !== '');
        const buySignals = dataWithSignals.filter(r => r.Signal === 'ä¹°å…¥');
        const sellSignals = dataWithSignals.filter(r => r.Signal === 'å–å‡º');
        
        console.log(`ä¿¡å·ç”Ÿæˆå®Œæˆï¼š`);
        console.log(`- æ€»äº¤æ˜“ä¿¡å·: ${allSignals.length} ä¸ª`);
        console.log(`- ä¹°å…¥ä¿¡å·: ${buySignals.length} ä¸ª`);
        console.log(`- å–å‡ºä¿¡å·: ${sellSignals.length} ä¸ª`);
        
        // è·å–æœ€ç»ˆä»“ä½çŠ¶æ€
        const finalPosition = dataWithSignals.length > 0 ? dataWithSignals[dataWithSignals.length - 1].POSITION : 'æœªçŸ¥';
        console.log(`- æœ€ç»ˆä»“ä½çŠ¶æ€: ${finalPosition}`);

        return dataWithSignals;
    }

    function formatNumber(num) {
      if (num == null || isNaN(num)) return 'N/A';
      if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
      if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
      return num.toFixed(2);
    }

    function formatDate(date) {
      return date.toLocaleDateString('zh-CN');
    }

    async function renderDashboard() {
      const root = document.getElementById('root');
      root.innerHTML = `
        <div class="glass-effect rounded-3xl p-8 text-center">
          <div class="loading-spinner w-16 h-16 border-4 border-white border-t-transparent rounded-full mx-auto mb-6"></div>
          <h2 class="text-2xl font-bold text-white mb-2">æ­£åœ¨åŠ è½½æ•°æ®...</h2>
          <p class="text-white text-opacity-80">è¯·ç¨å€™ï¼Œæ­£åœ¨è·å–æœ€æ–°çš„BTCäº¤æ˜“æ•°æ®</p>
        </div>
      `;
      console.log("å¼€å§‹æ¸²æŸ“ä»ªè¡¨æ¿ã€‚");

      const rawData = await loadData();
      if (rawData.length < 20) {
        root.innerHTML = `
          <div class="glass-effect rounded-3xl p-8 text-center">
            <div class="text-6xl mb-4">âš ï¸</div>
            <h2 class="text-2xl font-bold text-white mb-4">æ•°æ®ä¸è¶³</h2>
            <p class="text-white text-opacity-80">æ— æ³•åŠ è½½è¶³å¤Ÿæ•°æ®è¿›è¡Œåˆ†æã€‚éœ€è¦è‡³å°‘20å¤©çš„æ•°æ®ï¼Œå½“å‰åªæœ‰ ${rawData.length} å¤©ã€‚</p>
            <p class="text-white text-opacity-60 mt-2">è¯·æ£€æŸ¥APIå¯†é’¥ã€APIæœåŠ¡çŠ¶æ€æˆ–ç¨åå†è¯•ã€‚</p>
          </div>
        `;
        console.error(`æ•°æ®ä¸è¶³è¿›è¡Œåˆ†æ: æ‰¾åˆ°${rawData.length}å¤©æ•°æ®ï¼Œéœ€è¦20å¤©ã€‚`);
        return;
      }

      const dataWithMA = calculateIndicators(rawData);
      const dataWithSignals = generateSignals(dataWithMA);

      // è·å–æœ€æ–°æ•°æ®
      const latest = dataWithSignals[dataWithSignals.length - 1] || {};
      const currentPosition = latest.POSITION || 'æœªçŸ¥';
      console.log(`è·å–æœ€æ–°æ•°æ®: æœ€åä¸€å¤©æ˜¯ ${latest.date ? formatDate(latest.date) : 'N/A'}, ä»“ä½: ${currentPosition}, ä¿¡å·: ${latest.Signal || 'æ— '}`);
      
      const latestPrice = latest.price || 0;
      const latestChange = dataWithSignals.length > 1 && dataWithSignals[dataWithSignals.length - 2].price !== 0
        ? ((latestPrice - dataWithSignals[dataWithSignals.length - 2].price) / dataWithSignals[dataWithSignals.length - 2].price * 100).toFixed(2)
        : 'N/A';
      const latest20MA = latest.BTC20MA;
      const latestTrend = latest.BTC20MAtrend || 'æœªçŸ¥';
      const pricePosition = (latestPrice != null && latest20MA != null && latest20MA !== 0)
        ? (latestPrice > latest20MA ? 'é«˜äº20æ—¥å‡çº¿' : 'ä½äº20æ—¥å‡çº¿')
        : 'æœªçŸ¥';

      // è·å–æœ€è¿‘çš„äº¤æ˜“ä¿¡å·
      const recentSignals = dataWithSignals
        .filter(r => r.Signal && r.Signal !== '')
        .slice(-5)
        .reverse();
      console.log("æ‰¾åˆ°çš„æœ€è¿‘äº¤æ˜“ä¿¡å·:", recentSignals);

      // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
      const totalSignals = dataWithSignals.filter(r => r.Signal && r.Signal !== '').length;
      const buySignals = dataWithSignals.filter(r => r.Signal === 'ä¹°å…¥').length;
      const sellSignals = dataWithSignals.filter(r => r.Signal === 'å–å‡º').length;

      root.innerHTML = `
        <div class="glass-effect rounded-3xl p-8 mb-6">
          <div class="text-center mb-8">
            <h1 class="text-4xl font-bold gradient-text mb-4 flex items-center justify-center">
              <span class="text-5xl mr-4">â‚¿</span>
              BTCæ™ºèƒ½äº¤æ˜“åˆ†æç³»ç»Ÿ
              <div class="status-indicator ml-4">
                <div class="w-3 h-3 bg-green-500 rounded-full pulse-animation"></div>
              </div>
            </h1>
            <p class="text-white text-opacity-80 text-lg">åŸºäº20æ—¥å‡çº¿çš„ä¸“ä¸šçº§äº¤æ˜“ä¿¡å·åˆ†æ</p>
          </div>

          <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="glass-effect rounded-2xl p-6 card-hover">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-white">ğŸ¯ äº¤æ˜“å»ºè®®</h2>
                <div class="w-3 h-3 ${currentPosition === 'æŒæœ‰' ? 'bg-green-400' : 'bg-red-400'} rounded-full pulse-animation"></div>
              </div>
              <p class="text-3xl font-bold ${currentPosition === 'æŒæœ‰' ? 'text-green-400' : 'text-red-400'} mb-2">${currentPosition}</p>
              <p class="text-white text-opacity-60 text-sm">åŸºäºæŠ€æœ¯æŒ‡æ ‡åˆ†æ</p>
            </div>

            <div class="glass-effect rounded-2xl p-6 card-hover">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-white">ğŸ’° å½“å‰ä»·æ ¼</h2>
                <span class="text-2xl">ğŸ’</span>
              </div>
              <p class="text-3xl font-bold text-yellow-400 mb-2">$${formatNumber(latestPrice)}</p>
              <p class="text-white text-opacity-80 text-sm flex items-center">
                <span class="mr-2">${latestChange >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'}</span>
                24h: ${latestChange}%
              </p>
            </div>

            <div class="glass-effect rounded-2xl p-6 card-hover">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-white">ğŸ“ˆ 20æ—¥å‡çº¿</h2>
                <span class="text-2xl">${latestTrend === 'ä¸Šå‡' ? 'ğŸš€' : 'ğŸ“‰'}</span>
              </div>
              <p class="text-2xl font-bold text-blue-400 mb-2">$${formatNumber(latest20MA)}</p>
              <p class="text-white text-opacity-80 text-sm">è¶‹åŠ¿: ${latestTrend}</p>
              <p class="text-white text-opacity-60 text-xs">${pricePosition}</p>
            </div>

            <div class="glass-effect rounded-2xl p-6 card-hover">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-white">ğŸ“Š ä¿¡å·ç»Ÿè®¡</h2>
                <span class="text-2xl">ğŸ“ˆ</span>
              </div>
              <p class="text-white text-opacity-80 text-sm mb-1">æ€»ä¿¡å·: <span class="font-bold">${totalSignals}</span></p>
              <p class="text-green-400 text-sm mb-1">ä¹°å…¥: <span class="font-bold">${buySignals}</span></p>
              <p class="text-red-400 text-sm">å–å‡º: <span class="font-bold">${sellSignals}</span></p>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6 mb-8">
            <div class="glass-effect rounded-2xl p-6">
              <h2 class="text-xl font-semibold text-white mb-6 flex items-center">
                <span class="mr-3">ğŸ”</span>æœ€è¿‘äº¤æ˜“ä¿¡å·
              </h2>
              <div class="space-y-3">
                ${recentSignals.length > 0 ? recentSignals.map(s => `
                  <div class="glass-effect rounded-xl p-4 flex justify-between items-center">
                    <span class="text-white text-opacity-80">${formatDate(s.date)}</span>
                    <span class="px-3 py-1 rounded-full text-sm font-medium ${s.Signal === 'ä¹°å…¥' ? 'bg-green-500 bg-opacity-20 text-green-400 border border-green-400' : 'bg-red-500 bg-opacity-20 text-red-400 border border-red-400'}">${s.Signal}</span>
                    <span class="font-mono text-white font-bold">$${formatNumber(s.price)}</span>
                  </div>
                `).join('') : '<div class="text-white text-opacity-60 text-center py-8">æš‚æ— è¿‘æœŸäº¤æ˜“ä¿¡å·</div>'}
              </div>
            </div>

            <div class="glass-effect rounded-2xl p-6">
              <h2 class="text-xl font-semibold text-white mb-6 flex items-center">
                <span class="mr-3">ğŸ“‹</span>äº¤æ˜“é€»è¾‘è¯´æ˜
              </h2>
              <div class="text-sm text-white text-opacity-80 space-y-4">
                <div class="glass-effect rounded-xl p-4">
                  <p class="font-semibold text-green-400 mb-3">ğŸŸ¢ ä¹°å…¥æ¡ä»¶ï¼ˆä¸‰é¡¹åŒæ—¶æ»¡è¶³ï¼‰:</p>
                  <ul class="space-y-2 ml-4">
                    <li class="flex items-center"><span class="mr-2">â€¢</span> å‰ä¸€æ—¥ä¸ºç©ºä»“çŠ¶æ€</li>
                    <li class="flex items-center"><span class="mr-2">â€¢</span> 20æ—¥å‡çº¿è¶‹åŠ¿ä¸Šå‡</li>
                    <li class="flex items-center"><span class="mr-2">â€¢</span> ä»·æ ¼é«˜äºå‡çº¿1%ä»¥ä¸Š</li>
                  </ul>
                </div>
                <div class="glass-effect rounded-xl p-4">
                  <p class="font-semibold text-red-400 mb-3">ğŸ”´ å–å‡ºæ¡ä»¶ï¼ˆä¸‰é¡¹åŒæ—¶æ»¡è¶³ï¼‰:</p>
                  <ul class="space-y-2 ml-4">
                    <li class="flex items-center"><span class="mr-2">â€¢</span> å‰ä¸€æ—¥ä¸ºæŒä»“çŠ¶æ€</li>
                    <li class="flex items-center"><span class="mr-2">â€¢</span> 20æ—¥å‡çº¿è¶‹åŠ¿ä¸‹é™</li>
                    <li class="flex items-center"><span class="mr-2">â€¢</span> ä»·æ ¼ä½äºå‡çº¿1%ä»¥ä¸Š</li>
                  </ul>
                </div>
                <div class="glass-effect rounded-xl p-3 bg-blue-500 bg-opacity-20 border border-blue-400">
                  <p class="text-xs text-blue-300">
                    <strong>ğŸ’¡ æ™ºèƒ½æç¤ºï¼š</strong>ä¿¡å·è§¦å‘åä»“ä½çŠ¶æ€ç«‹å³æ”¹å˜ï¼Œå¹¶æŒç»­åˆ°ä¸‹ä¸€ä¸ªç›¸åä¿¡å·å‡ºç°ã€‚
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="glass-effect rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-6 flex items-center">
              <span class="mr-3">ğŸ“ˆ</span>ä»·æ ¼èµ°åŠ¿å›¾
            </h2>
            <div class="bg-white bg-opacity-10 rounded-xl p-4">
              <canvas id="chart" height="100"></canvas>
            </div>
          </div>

          <div class="text-center">
            <div class="glass-effect rounded-2xl p-6 mb-4">
              <p class="text-white text-opacity-80 text-sm mb-3">
                âš ï¸ æœ¬åˆ†æä»…ä¾›å‚è€ƒï¼ŒæŠ•èµ„æœ‰é£é™©ï¼Œå†³ç­–éœ€è°¨æ…
              </p>
              <p class="text-white text-opacity-60 text-xs mb-4">
                æœ€åæ›´æ–°æ—¶é—´: ${new Date().toLocaleString('zh-CN')} | æ•°æ®æ¥æº: å®æ—¶API
              </p>
              <button onclick="window.showDebugInfo()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105">
                ğŸ”§ æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
              </button>
            </div>
            <div id="debugInfo" class="hidden glass-effect rounded-2xl p-6 text-left text-sm">
              <h3 class="font-bold text-white mb-4 flex items-center">
                <span class="mr-2">ğŸ›</span>è°ƒè¯•ä¿¡æ¯
              </h3>
              <div id="debugContent" class="text-white text-opacity-80"></div>
            </div>
          </div>
        </div>
      `;

      // ç»˜åˆ¶å›¾è¡¨
      const ctx = document.getElementById('chart').getContext('2d');
      
      // å‡†å¤‡å›¾è¡¨æ•°æ® - åªæ˜¾ç¤ºæœ€è¿‘60å¤©çš„æ•°æ®ä»¥æé«˜æ€§èƒ½
      const chartData = dataWithSignals.slice(-60);

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: chartData.map(r => formatDate(r.date)),
          datasets: [
            {
              label: 'BTCä»·æ ¼',
              data: chartData.map(r => r.price),
              borderColor: '#60A5FA',
              backgroundColor: 'rgba(96, 165, 250, 0.1)',
              borderWidth: 3,
              tension: 0.2,
              fill: true,
              pointRadius: 2,
              pointHoverRadius: 6,
              pointBackgroundColor: '#60A5FA',
              pointBorderColor: '#ffffff',
              pointBorderWidth: 2
            },
            {
              label: '20æ—¥å‡çº¿',
              data: chartData.map(r => r.BTC20MA),
              borderColor: '#FBBF24',
              backgroundColor: 'rgba(251, 191, 36, 0.1)',
              borderWidth: 2,
              tension: 0.2,
              fill: false,
              pointRadius: 1,
              pointHoverRadius: 4,
              pointBackgroundColor: '#FBBF24'
            },
            {
              label: 'ä¹°å…¥ä¿¡å·',
              data: chartData.map(r => r.Signal === 'ä¹°å…¥' ? r.price : null),
              borderColor: '#10B981',
              backgroundColor: '#10B981',
              pointBackgroundColor: '#10B981',
              pointBorderColor: '#ffffff',
              pointRadius: 8,
              pointHoverRadius: 10,
              showLine: false,
              pointBorderWidth: 3
            },
            {
              label: 'å–å‡ºä¿¡å·',
              data: chartData.map(r => r.Signal === 'å–å‡º' ? r.price : null),
              borderColor: '#EF4444',
              backgroundColor: '#EF4444',
              pointBackgroundColor: '#EF4444',
              pointBorderColor: '#ffffff',
              pointRadius: 8,
              pointHoverRadius: 10,
              showLine: false,
              pointBorderWidth: 3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { 
            legend: { 
              position: 'top',
              labels: {
                color: '#ffffff',
                font: {
                  size: 14,
                  weight: '500'
                },
                usePointStyle: true,
                padding: 20
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              titleColor: '#ffffff',
              bodyColor: '#ffffff',
              borderColor: 'rgba(255, 255, 255, 0.3)',
              borderWidth: 1,
              cornerRadius: 12,
              callbacks: {
                label: function(context) {
                  const label = context.dataset.label || '';
                  const value = context.parsed.y;
                  if (label.includes('ä¿¡å·')) {
                    return label + ': ' + formatNumber(value);
                  }
                  return label + ': ' + formatNumber(value);
                }
              }
            }
          },
          scales: {
            x: {
              display: true,
              title: {
                display: true,
                text: 'æ—¥æœŸ',
                color: '#ffffff',
                font: {
                  size: 14,
                  weight: '500'
                }
              },
              ticks: {
                color: '#ffffff',
                font: {
                  size: 12
                }
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: 'ä»·æ ¼ (USD)',
                color: '#ffffff',
                font: {
                  size: 14,
                  weight: '500'
                }
              },
              ticks: { 
                callback: value => '$' + formatNumber(value),
                color: '#ffffff',
                font: {
                  size: 12
                }
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          },
          interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
          }
        }
      });
      
      console.log("ä»ªè¡¨æ¿æ¸²æŸ“å®Œæˆã€‚");
      
      // æ·»åŠ è°ƒè¯•åŠŸèƒ½
      window.showDebugInfo = function() {
        const debugDiv = document.getElementById('debugInfo');
        const debugContent = document.getElementById('debugContent');
        
        if (debugDiv.classList.contains('hidden')) {
          debugDiv.classList.remove('hidden');
          
          const lastData = dataWithSignals.slice(-10);
          let debugHTML = '<div class="mb-4"><strong class="text-yellow-400">æœ€å10å¤©æ•°æ®åˆ†æï¼š</strong></div>';
          
          lastData.forEach((item, idx) => {
            const actualIndex = dataWithSignals.length - 10 + idx;
            debugHTML += `
              <div class="mb-3 p-4 glass-effect rounded-xl border border-white border-opacity-20">
                <div class="flex justify-between items-center mb-2">
                  <strong class="text-blue-400">ç¬¬${actualIndex + 1}å¤© (${formatDate(item.date)})</strong>
                  <span class="px-2 py-1 rounded-lg text-xs ${item.Signal ? (item.Signal === 'ä¹°å…¥' ? 'bg-green-500 bg-opacity-20 text-green-400' : 'bg-red-500 bg-opacity-20 text-red-400') : 'bg-gray-500 bg-opacity-20 text-gray-400'}">${item.Signal || 'æ— ä¿¡å·'}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div>ä»·æ ¼: <span class="text-yellow-400 font-mono">${formatNumber(item.price)}</span></div>
                  <div>20æ—¥å‡çº¿: <span class="text-blue-400 font-mono">${item.BTC20MA ? formatNumber(item.BTC20MA) : 'N/A'}</span></div>
                  <div>è¶‹åŠ¿: <span class="text-purple-400">${item.BTC20MAtrend}</span></div>
                  <div>ä»“ä½: <span class="${item.POSITION === 'æŒæœ‰' ? 'text-green-400' : 'text-red-400'} font-bold">${item.POSITION}</span></div>
                </div>
              </div>
            `;
          });
          
          debugHTML += `
            <div class="mt-6 grid grid-cols-2 gap-4 text-sm">
              <div class="glass-effect rounded-xl p-4">
                <div class="text-yellow-400 font-bold mb-2">æ•°æ®ç»Ÿè®¡</div>
                <div>æ€»æ•°æ®é‡: <span class="text-white font-bold">${dataWithSignals.length}</span> å¤©</div>
                <div>æœ‰æ•ˆå‡çº¿: <span class="text-white font-bold">${dataWithSignals.filter(r => r.BTC20MA != null).length}</span> å¤©</div>
                <div>æœ‰è¶‹åŠ¿æ•°æ®: <span class="text-white font-bold">${dataWithSignals.filter(r => r.BTC20MAtrend !== 'æœªçŸ¥').length}</span> å¤©</div>
              </div>
              <div class="glass-effect rounded-xl p-4">
                <div class="text-yellow-400 font-bold mb-2">ä¿¡å·ç»Ÿè®¡</div>
                <div>æ€»äº¤æ˜“ä¿¡å·: <span class="text-white font-bold">${dataWithSignals.filter(r => r.Signal && r.Signal !== '').length}</span> ä¸ª</div>
                <div>ä¹°å…¥ä¿¡å·: <span class="text-green-400 font-bold">${dataWithSignals.filter(r => r.Signal === 'ä¹°å…¥').length}</span> ä¸ª</div>
                <div>å–å‡ºä¿¡å·: <span class="text-red-400 font-bold">${dataWithSignals.filter(r => r.Signal === 'å–å‡º').length}</span> ä¸ª</div>
              </div>
            </div>
          `;
          
          debugContent.innerHTML = debugHTML;
        } else {
          debugDiv.classList.add('hidden');
        }
      };
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderDashboard();
    
    // è®¾ç½®è‡ªåŠ¨åˆ·æ–° - æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
    setInterval(renderDashboard, 5 * 60 * 1000);
  </script>

</body>
</html>
